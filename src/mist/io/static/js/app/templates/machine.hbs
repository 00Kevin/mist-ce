<div id="single-machine-page" data-role="page" class="ui-page-active" data-theme="a">

    <div data-role="header" data-theme="a">
        <!-- Page header -->
        <div class="ui-header ui-bar-a">
            <div class="header-grid">
                <div class="ui-grid-b">
                    <div class="ui-block-a">
                        <a href="#/machines" class="responsive-button ui-btn icon-prev ui-alt-icon ui-caps
                        ui-btn-icon-left ui-corner-all">Machines</a>
                    </div>

                    <div class="ui-block-b">
                        <h1 class="ui-title">{{name}}</h1>
                    </div>

                    <div class="ui-block-c">
                        <div class="user-menu">
                            {{view "userMenu"}}
                        </div>
                    </div>
                </div><!-- /grid-b -->
            </div>
        </div>
    </div>

    <div data-role="header" data-theme="a" class="single-machine-header">
        <div class="header-grid">
            <div class="ui-grid-b">
                <div class="ui-block-a">
                    <!-- Provider Icon -->
                    <span class="single-view-icon-wrapper">
                        <span id="single-view-provider-icon"
                            class={{view.providerIconClass}}>
                        </span>
                    </span>

                    <!-- OS Icon -->
                    <span class="single-view-icon-wrapper">
                        <span id="single-view-image-icon"
                            class={{view.imageIconClass}}>
                        </span>
                    </span>
                </div>

                <div class="ui-block-b">
                    <!-- State label -->
                    <h1 class={{state}}>
                        {{#unless isUnknown}}
                            {{state}}
                        {{/unless}}
                    </h1>
                </div>

                <div class="ui-block-c">
                    <!-- Show spinner if machines are being loaded -->
                    {{#unless id}}
                        {{#if Mist.backendsController.loadingMachines}}
                            <div class="ajax-loader"></div>
                        {{/if}}
                    {{/unless}}


                    <!-- If machine is not running created, disable keys UI -->
                    {{#unless isWindows}}
                    <span id="mist-manage-keys"
                        class="{{if view.isRunning '' 'ui-state-disabled'}}">

                        <!-- If machine is beging created, hide keys UI -->
                        {{#unless pendingCreation}}
                            {{#if keysCount}}
                                <a class="ui-btn
                                        ui-shadow
                                        ui-corner-all
                                        ui-icon-plus
                                        ui-btn-icon-left
                                        ui-caps"
                                    {{action "manageKeysClicked" target=view}}>
                                    {{keysCount}} keys
                                </a>
                            {{else}}
                                <a class="ui-btn
                                        ui-btn-d
                                        ui-icon-plus
                                        ui-shadow
                                        ui-icon-plus
                                        ui-btn-icon-left
                                        ui-caps"
                                    {{action "addKeyClicked" target=view}}>
                                    Add key
                                </a>
                            {{/if}}
                        {{/unless}}
                    </span>
                    {{/unless}}
                </div>
            </div><!-- /grid-b -->
        </div>
    </div>

    <div data-role="content" data-theme="a">


        <!--

             Monitoring collapsible

        -->


        <div id="monitoring-collapsible" data-role="collapsible" data-collapsed="false" class="ui-shadow">

            <h4>Monitoring</h4>
            {{#if view.machine}}
            {{view "machineMonitoring" machine=view.machine}}
            {{/if}}

        </div>


        <!--

             Information collapsibles

        -->


        <div data-role="collapsible" data-collapsed="false" class="ui-shadow">

            <h4>Basic Info</h4>

            <table class="info-table">
                <tbody>
                <tr>
                    <td>Last probed</td>
                    <td> {{#if probing}}
                             probing... <div class="ajax-loader"></div>
                         {{else}}
                             {{view.lastProbe}}
                             <a id="machine-probe-btn"
                                class="ui-btn ui-btn-d ui-shadow"
                                {{action "probeClicked" target=view}}>
                                    Probe
                            </a>
                         {{/if}}
                    </td>
                </tr>
                {{#if probed}}
                    <tr>
                        <td>Up and running for</td>
                        <td>{{view.upFor}}</td>
                    </tr>
                {{/if}}
                {{#if loadavg}}
                    <tr>
                        <td>Load</td>
                        <td>
                            <div class="loadleds">
                                <div class="{{loadavg15}} led">
                                </div>
                                <div class="{{loadavg5}} led">
                                </div>
                                <div class="{{loadavg1}} led">
                                </div>
                            </div>
                            {{loadavg}} {{#if cores}}- {{cores}} cores {{/if}}- {{loadavg5}}
                        </td>
                    </tr>
                {{/if}}
                {{#if latency}}
                    <tr>
                        <td>Latency</td>
                        <td>
                            <div class="netleds">
                                <div class="{{netled4}} netled1">
                                </div>
                                <div class="{{netled3}} netled2">
                                </div>
                                <div class="{{netled2}} netled3">
                                </div>
                                <div class="{{netled1}} netled4">
                                </div>
                            </div>
                            {{latency}}ms</td>
                    </tr>
                {{/if}}
                {{#if loss}}
                    <tr>
                        <td>Packet loss</td>
                        <td>{{loss}}</td>
                    </tr>
                {{/if}}
                {{#if tags}}
                    <tr>
                        <td>Tags</td>
                        <td>
                            {{#each tags as |tag|}}
                            <span class="tag">{{tag}}</span>
                            {{/each}}
                        </td>
                    </tr>
                {{/if}}
                {{#if view.public_ips}}
                    <tr>
                        <td>Public IPs</td>
                        <td>
                            {{#each view.public_ips as |ip|}}
                                <div class="ip">{{ip}}</div>
                            {{/each}}
                        </td>
                    </tr>
                {{/if}}
                {{#if view.private_ips}}
                    <tr>
                        <td>Private IPs</td>
                        <td>
                            {{#each view.private_ips as |ip|}}
                                <div class="ip">{{ip}}</div>
                            {{/each}}
                        </td>
                    </tr>
                {{/if}}
                {{#if view.machine.df}}
                    <tr>
                        <td colspan="2"><div class="df">{{view.machine.df}}</div></td>
                    </tr>
                {{/if}}
                {{#each view.basicInfo as |row|}}
                    <tr>
                        <td>{{row.key}}</td>
                        <td>{{row.value}}</td>
                    </tr>
                {{/each}}
            </tbody>
            </table>
        </div>

        {{#if view.metadata}}
            <div id="single-machine-metadata" data-role="collapsible" class="ui-shadow">

                <h4>Full metadata list</h4>

                <table class="info-table">
                    <tbody>
                    {{#each view.metadata as |row|}}
                        <tr>
                            <td>{{row.key}}</td>
                            <td>{{row.value}}</td>
                        </tr>
                    {{/each}}
                    </tbody>
                </table>

            </div>
        {{/if}}

    </div>

    {{view "dialog"}}

    {{view "metricAdd"}}

    {{view "machineKeys"}}

    {{view "machineTags"}}

    {{view "machineShell"}}

    {{view "machinePower" position="#single-machine-power-btn"}}

    <div class="tri-action-footer ui-shadow" data-role="footer" data-theme="b">
        <table>
            <tbody>
                <tr>
                    <td>
                        <a id="single-machine-tags-btn"
                            class="{{if id '' 'ui-state-disabled'}}
                                {{if can_tag '' 'ui-state-disabled'}}
                                ui-btn ui-btn-icon-right ui-icon-grid ui-caps icon-tag"
                            {{action "tagsClicked" target=view}}>Tags</a>
                    </td>
                    <td>
                        {{#if isWindows}}
                        <a id="single-machine-shell-btn"
                            target="_blank"
                            href={{rdpURL}} class="{{if canConnect '' 'ui-state-disabled'}}
                                ui-btn ui-btn-icon-left ui-icon-gear ui-caps">Connect</a>
                        {{else}}
                        <a id="single-machine-shell-btn"
                            class="{{if canConnect '' 'ui-state-disabled'}}
                                ui-btn ui-btn-icon-right ui-icon-shell ui-caps"
                            {{action "shellClicked" target=view}}>Shell</a>
                        {{/if}}
                    </td>
                    <td>
                        <a id="single-machine-power-btn"
                            class="{{if id '' 'ui-state-disabled'}}
                                ui-btn ui-btn-icon-right icon-cof ui-caps"
                            {{action "powerClicked" target=view}}>Actions</a>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>
