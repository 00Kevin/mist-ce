<div id="single-machine-page" data-role="page" class="ui-page-active" data-theme="c">
    
    <div data-role="header" data-theme="b">
    
        <a href="#/machines" data-icon="arrow-l">Machines</a>
    
        <h1>{{name}}</h1>
    
        {{view Mist.userMenuView}}
    
    </div>
    
    <div data-role="header" data-theme="a">

        <h1 {{bind-attr class="view.machine.state"}}>{{state}}</h1>
        
        <span class="ui-btn-right" id="mist-manage-keys">
            {{#if pendingCreation}}
                <a class="ui-state-disabled" data-role="button" data-icon="plus" data-iconpos="right">Add key</a>
            {{else}} {{#if keysCount}}
                <a data-role="button" {{action "manageKeysClicked" target="view"}}>{{keysCount}} keys</a>
            {{else}}
                <a data-role="button"
                   data-theme="b" 
                   data-icon="plus" 
                   data-iconpos="right"
                   {{action "addKeyClicked" target="view"}}>Add key</a>
            {{/if}}{{/if}}
        </span>
    </div>
    
    <div data-role="content" data-theme="c">

        <!--
            
             Monitoring collapsibles
             
        -->

        <div data-role="collapsible" id="monitoring-collapsible" data-collapsed="false">
            
            <h3>Monitoring</h3>
     
            <div class="ui-loader ui-corner-all ui-body-b ui-loader-verbose">
                <span class="ui-icon ui-icon-loading"></span>
                <h1>Fecting data</h1>
            </div>

            <div>
                {{#if hasMonitoring}}

                <div data-role="listview">
                    {{#each view.rules}}
                        {{view Mist.ruleView ruleBinding="this"}}
                    {{/each}}
                    
                    {{#if Mist.rulesController.creationPending}}
                    <div class="rule-box" id="creation-rule">
                        <div class="ajax-loader"></div>
                    </div>
                    {{/if}}
                </div>
                
                <div class="add-rule-container">
                    <button id="add-rule-button"
                        data-icon="plus"
                        data-theme="b"
                        {{action addRuleClicked target="view"}}>Add Rule</button>
                </div>
                
                {{view Mist.MonitoringView}} 

                <a data-role="button" {{action "disableClicked" target="view"}}>Disable</a>
                <div class="ui-loader ui-corner-all ui-body-b ui-loader-verbose">
                    <span class="ui-icon ui-icon-loading"></span>
                    <h1>Disabling monitoring</h1>
                </div>
                {{else}}
                <div id="monitoring-disabled">
                    <p>Monitoring is currently disabled</p>
                    <a data-role="button" data-icon="star" data-theme="b" {{action "enableMonitoringClicked" target="view"}}>Enable</a>
                </div>
                {{/if}}
    
            </div>
        </div>

        <!--
            
             Information collapsibles
             
        -->

        <div data-role="collapsible">

            <h3>Basic Info</h3>

            <table class="info-table">
                {{#if tags}}
                <tr>
                    <td>Tags</td>
                    <td>
                        {{#each tags}}
                        <span class="tag">{{this}}</span>
                        {{/each}}
                    </td>
                </tr>
                {{/if}}

                {{#if uptime}}
                <tr>
                    <td>Up and running for</td>
                    <td>{{view.upFor}}</td>
                </tr>
                {{/if}}

                {{#each view.basicInfo}}
                <tr>    
                    <td>{{key}}</td>
                    <td>{{value}}</td>
                </tr>
                {{/each}}
            </table>
        </div>

        <div data-role="collapsible">

            <h3>Full metadata list</h3>

            <table class="info-table">
                {{#each view.metadata}}
                <tr>
                    <td>{{key}}</td>
                    <td>{{value}}</td>
                </tr>
                {{/each}}
            </table>

        </div>

        <div class="large-padding"></div>

    </div>
    
    {{view Mist.shellView}}

    {{view Mist.machineKeysView}}

    {{view Mist.machineTagsView}}

    {{view Mist.machinePowerView}}

    {{view Mist.confirmationDialog}}

    <div data-role="popup">
        <ul data-role="listview">
            {{#each Mist.rulesController.metricList}}
            <li data-icon="false">
                <a>{{this}}</a>
            </li>
            {{/each}}
        </ul>
    </div>

    <div data-role="popup">
        <ul data-role="listview">
            {{#each Mist.rulesController.operatorList}}
            <li data-icon="false">
                <a>{{this.symbol}}</a>
            </li>
            {{/each}}
        </ul>
    </div>

    <div data-role="popup">
        <ul data-role="listview">
            {{#each Mist.rulesController.actionList}}
            <li data-icon="false">
                <a>{{this}}</a>
            </li>
            {{/each}}
            <li data-icon="false">
                <a>launch</a>
            </li>
        </ul>
    </div>
    
    <div data-role="popup">
        <div data-role="header">
            <h1>Command</h1>
        </div>
        <div data-role="content">
            {{view Ember.TextArea
                valueBinding="Mist.rulesController.command"
                name="rule-command-content"}}            
            <div data-role="controlgroup" class="btn-full ok-cancel" data-type="horizontal">
                <a data-role="button" data-theme="c" data-rel="back">Back</a>
                <a data-role="button" data-theme="b" {{action saveCommand target="Mist.rulesController"}}>Save</a>
            </div>
            <div class="ajax-loader"></div>
        </div>
    </div>

    <div data-role="popup" id="monitoring-dialog" class="mist-dialog" data-overlay-theme="a">
        <div data-role="header">
            <h1>Disable monitoring</h1>
        </div>
        <div data-role="content" data-theme="b">
            <div id="monitoring-enabled">
                <span>Are you sure you wish to disable monitoring for {{name}}?</span>
    
                {{#unless probed}}
                    <p>The collectd daemon can't be disabled automactically because there is no key pair set.</p>
                    <p>To do it manually run the following commands:</p>
                    <pre>chmod -x /etc/init.d/collectd &amp;&amp; killall -9 collectd</pre>
                {{/unless}}
    
                <div class="btn-full ok-cancel" data-role="controlgroup" data-type="horizontal">
                    <button data-theme="c" id="button-back-enabled" {{action buttonBackMonitoring target="view"}}>Back</button>
                    <button data-theme="b" id="button-disable-monitoring" {{action buttonChangeMonitoring target="view"}}>Disable</button>
                </div>
            </div>
            <div id="monitoring-disabled">
                <div id="enable-monitoring-dialog">
                    <div>Are you sure you wish to enable monitoring for {{name}}?</div>
    
                    {{#unless probed}}
                        <p>The collectd daemon can't be installed automatically because there is no key pair set.</p>
                        <p>You will have to configure it manually by following the instructions after pressing enable.</p>
                    {{/unless}}
    
                    <div class="btn-full ok-cancel" data-role="controlgroup" data-type="horizontal">
                        <button data-theme="c" id="button-back-disabled" {{action buttonBackMonitoring target="view"}}>Back</button>
                        <button data-theme="b" id="button-enable-monitoring" {{action buttonChangeMonitoring target="view"}}>Enable</button>
                    </div>
                </div>
                <div id="plan-dialog">
                    <div id="plan-text"><span></span></div>
                    <div class="btn-full ok-cancel" data-role="controlgroup" data-type="horizontal">
                        <button data-theme="c" id="button-back-plan" {{action "closePlanDialog" target="view"}}>Back</button>
                        <button data-theme="b" id="button-enable-trial" {{action "openTrialDialog" target="view"}}>Enable Trial</button>
                        <button data-theme="b" id="button-purchase" {{action "clickedPurchaseDialog" target="view"}}>Purchase Plan</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div data-role="popup" id="login-dialog" class="mist-dialog" data-overlay-theme="b">
        <div data-role="header">
            <h1>Login to mist.io</h1>
        </div>
        <div data-role="content" data-theme="b">
            <div class="info">In order to proceed you need to login to the premium <a href="https://mist.io">mist.io</a> service.</div>
    
            <label for="email">Email</label>
            {{view Mist.TextField valueBinding="Mist.email" name="email" id="email"}}
    
            <label for="password">Password</label>
            {{view Mist.TextField type="password" valueBinding="Mist.password" name="password" id="password"}}
    
            <div class="btn-full ok-cancel" data-role="controlgroup" data-type="horizontal">
                <button data-theme="c" {{action "backLoginClicked" target="view"}}>Back</button>
                <button id="auth-ok" data-theme="b" {{action "doLogin" target="view"}}>Login</button>
            </div>
            <div class="ajax-loader"></div>
        </div>
    </div>


    <div class="tri-action-footer" data-role="footer" data-theme="b">
        <table><tbody><tr><td>
            <a id="single-machine-tags-btn" data-role="button" data-icon="grid" {{action "tagsClicked" target="view"}}>Tags</a>
        </td><td>
            <a id="single-machine-shell-btn" data-role="button" data-icon="gear" {{action "shellClicked" target="view"}}>Shell</a>
        </td><td>
            <a id="single-machine-power-btn" data-role="button" data-icon="power" {{action "powerClicked" target="view"}}>Power</a>
        </td></tr></tbody></table>
    </div>


</div>